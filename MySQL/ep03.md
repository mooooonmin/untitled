# COUNT(*) & COUNT(DISTINCT)

- `SELECT COUNT(*) >> SELECT *`
    - COUNT(*) 가 SELECT * 보다 빠를 것으로 기대 **BUT, 아님**

- 일반적으로
    - SELECT * -> LIMIT 와 동시에 사용
    - SELECT COUNT(*) -> LIMIT 없이 사용

- COUNT(*) vs COUNT(DISTINCT expr)
    - COUNT(*) : 레코드 건수만 확인
    - COUNT(DISTINCT expr) : 임시 테이블로 중복 제거 후 건수 확인
---
### COUNT(*) 튜닝
- 최고의 튜닝은 쿼리 자체를 제거하는 것
    - 전체 결과 건수 확인 쿼리 제거
    - 페이지 번호 없이, '이전' '이후' 페이지 이동
- 쿼리를 제거할 수 없다면, 대략적 건수 활용
    - 부분 레코드 건수 조회
    - 표시할 페이지 번호만큼의 레코드만 건수 확인
        - `SELECT COUNT(*) FROM (SELECT 1 FROM table LIMIT 200)z`
    - 임의의 페이지 번호는 표기
        - **첫 페이지에서 10개 페이지 표시 후, 실제 해당 페이지로 이동하면서 페이지 번호 보정**
            - 이 방법은 구현은 어렵지만, 매우 효일적일 것으로 예상
- 통계 정보 활용
    - 쿼리 조건이 없는 경우, 테이블 통계 활용
    - 쿼리 조건이 있는 경우, 실행 계획 활용
        - 정확도 낮음
        - 조인이나 서브쿼리 사용시 계산 난이도 높음
    - 성능은 빠르지만, 페이지를 이동하면서 보정 필요
---
- 제거 대상
    - WHERE 조건없는 COUNT(*)
    - WHERE 조건에 일치하는 레코드 건수가 많은 COUNT(*)

- 인덱스를 활용하여 최적화 대상
    - 정확한 COUNT(*)가 필요한 경우
    - COUNT(*) 대상 건수가 소량인 경우
    - WHERE 조건이 인덱스로 처리될 수 있는 경우